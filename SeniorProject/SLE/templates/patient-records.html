{% extends "header.html" %}
{% block content %}
	
<!-- Navigation -->
          <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" href="{% url 'index' %}">SLE Flare-up Predictor</a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">
                <!-- For Follow up -->
                <li style="background-color: #455379;"><a href="{% url 'patientrecord' patient.studynumber %}"> SN : {{patient.studynumber}} </a></li>
                <!--Normal-->
                <li>
                <a href="{% url 'index' %}"> Home </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i> {{user}} <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#"><i class="fa fa-fw fa-user"></i> ประวัติส่วนตัว</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-gear"></i> ตั้งค่า</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="{% url "logout" %}"><i class="fa fa-fw fa-power-off"></i> ลงชื่อออก</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>


        <div id="page-wrapper" >
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="x_panel">
                            <div class="x_title"> 
                                    <h2>SLEDAI score</h2>
                                    <div class="clearfix"></div>
                                </div>
						  <div class="x_content">
							<div id="chart_SLEDAI" style="width: 100%; min-height: 400px"></div>
						  </div>
						</div>
                        
                        <div class="x_panel">
				            <div class="x_title">
					               <h2>Medication</h2>
					               <div class="clearfix"></div>
						    </div>
				            <div class="x_content">
					       <div id="chart_Followup_med" style="width: 100%; min-height: 400px"></div>
				        </div>
			             </div>
                        
                        <div class="x_panel">
				            <div class="x_title">
					               <h2>Laboratory</h2>
					               <div class="clearfix"></div>
						    </div>
				            <div class="x_content">
					       <div id="chart_Followup_lab" style="width: 100%; min-height: 400px"></div>
				        </div>
			             </div>
					  </div>
                </div>
                <div class="row">
                    <div class="col-lg-7 col-md-7 col-sm-7">
                        <!--Follow up list -->
                        <div class="x_panel">
                           <div class="x_title"> 
                                <h2>SLE Patient</h2>
								<ul class="nav navbar-right panel_toolbox">	
									<li><a href="{% url 'followupnew' patient.studynumber %}">Add new follow up</a></li>
								</ul>
								<div class="clearfix"></div>
                            </div>
                           <div class="x_content">
                                   <table id="datatable" class="table table-bordered table-hover table-striped" >
                                       <thead>
                                           <tr>
                                               <th>Number</th>
                                               <th>Datetime</th>
                                               <th>Detail</th>
                                               <th>SLEDAI Score</th>
                                               <th>Stauts</th>
                                           </tr>
                                       </thead>
                                       <tbody>
                                           {% for visit in visit_list %}
                                           <tr>
                                               <td>{{ forloop.counter }}</td>
                                               <td>{{ visit.visitdate }}</td>
                                               <td><a href="{% url 'followDetail' visit.visitingid %}">See Detail</a></td>
                                               <td>
                                                   <div class="progress" style="margin-bottom:0;">
                                                      <div class="progress-bar" role="progressbar" style="width: 55%;" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100">55%</div>
                                                    </div>
                                               </td>
                                               <td><span class="label label-info">Inactive</span></td>
                                           </tr>
                                           {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                    </div>
                    <div class="col-lg-5 col-md-5 col-sm-5">
                        <!--Chart-->
                        <div class="x_panel">
                            <div class="x_title"> 
                                <h2>Enrollment</h2>
								<ul class="nav navbar-right panel_toolbox">
								</ul>
								<div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <ul style="margin:0;" class="pager">
                                        <li class="next"><a href="{% url 'enrollDetail' patient.studynumber %}">Full detail <span aria-hidden="true">&rarr;</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> 
            <!-- /.container-fluid -->
        </div>
        <!-- /#page-wrapper -->
    </div>
<script>
 if ("undefined" != typeof echarts) {
        var a = {
            color: ["#26B99A", "#34495E", "#BDC3C7", "#3498DB", "#9B59B6", "#8abb6f", "#759c6a", "#bfd3b7"],
            title: {
                itemGap: 8,
                textStyle: {
                    fontWeight: "normal",
                    color: "#408829"
                }
            },
            dataRange: {
                color: ["#1f610a", "#97b58d"]
            },
            toolbox: {
                color: ["#408829", "#408829", "#408829", "#408829"]
            },
            tooltip: {
                backgroundColor: "rgba(0,0,0,0.5)",
                axisPointer: {
                    type: "line",
                    lineStyle: {
                        color: "#408829",
                        type: "dashed"
                    },
                    crossStyle: {
                        color: "#408829"
                    },
                    shadowStyle: {
                        color: "rgba(200,200,200,0.3)"
                    }
                }
            },
            dataZoom: {
                dataBackgroundColor: "#eee",
                fillerColor: "rgba(64,136,41,0.2)",
                handleColor: "#408829"
            },
            grid: {
                borderWidth: 0
            },
            categoryAxis: {
                axisLine: {
                    lineStyle: {
                        color: "#408829"
                    }
                },
                splitLine: {
                    lineStyle: {
                        color: ["#eee"]
                    }
                }
            },
            valueAxis: {
                axisLine: {
                    lineStyle: {
                        color: "#408829"
                    }
                },
                splitArea: {
                    show: !0,
                    areaStyle: {
                        color: ["rgba(250,250,250,0.1)", "rgba(200,200,200,0.1)"]
                    }
                },
                splitLine: {
                    lineStyle: {
                        color: ["#eee"]
                    }
                }
            },
            timeline: {
                lineStyle: {
                    color: "#408829"
                },
                controlStyle: {
                    normal: {
                        color: "#408829"
                    },
                    emphasis: {
                        color: "#408829"
                    }
                }
            },
            k: {
                itemStyle: {
                    normal: {
                        color: "#68a54a",
                        color0: "#a9cba2",
                        lineStyle: {
                            width: 1,
                            color: "#408829",
                            color0: "#86b379"
                        }
                    }
                }
            },
            map: {
                itemStyle: {
                    normal: {
                        areaStyle: {
                            color: "#ddd"
                        },
                        label: {
                            textStyle: {
                                color: "#c12e34"
                            }
                        }
                    },
                    emphasis: {
                        areaStyle: {
                            color: "#99d2dd"
                        },
                        label: {
                            textStyle: {
                                color: "#c12e34"
                            }
                        }
                    }
                }
            },
            force: {
                itemStyle: {
                    normal: {
                        linkStyle: {
                            strokeColor: "#408829"
                        }
                    }
                }
            },
            chord: {
                padding: 4,
                itemStyle: {
                    normal: {
                        lineStyle: {
                            width: 1,
                            color: "rgba(128, 128, 128, 0.5)"
                        },
                        chordStyle: {
                            lineStyle: {
                                width: 1,
                                color: "rgba(128, 128, 128, 0.5)"
                            }
                        }
                    },
                    emphasis: {
                        lineStyle: {
                            width: 1,
                            color: "rgba(128, 128, 128, 0.5)"
                        },
                        chordStyle: {
                            lineStyle: {
                                width: 1,
                                color: "rgba(128, 128, 128, 0.5)"
                            }
                        }
                    }
                }
            },
            gauge: {
                startAngle: 225,
                endAngle: -45,
                axisLine: {
                    show: !0,
                    lineStyle: {
                        color: [
                            [.2, "#86b379"],
                            [.8, "#68a54a"],
                            [1, "#408829"]
                        ],
                        width: 8
                    }
                },
                axisTick: {
                    splitNumber: 10,
                    length: 12,
                    lineStyle: {
                        color: "auto"
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: "auto"
                    }
                },
                splitLine: {
                    length: 18,
                    lineStyle: {
                        color: "auto"
                    }
                },
                pointer: {
                    length: "90%",
                    color: "auto"
                },
                title: {
                    textStyle: {
                        color: "#333"
                    }
                },
                detail: {
                    textStyle: {
                        color: "auto"
                    }
                }
            },
            textStyle: {
                fontFamily: "Arial, Verdana, sans-serif"
            }
        };
        
        if ($("#chart_SLEDAI").length) {
            var f = echarts.init(document.getElementById("chart_SLEDAI"), a);
            f.setOption({
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data:[{% for sledai in SLEDAIdata %}"{{sledai.name}}",{% endfor %}]
                },
                toolbox: {
                    show: true,
                    feature : {
                        magicType : {show: true, type: ['line', 'bar']},
                        restore : {show: true}
                    }
                },
                calculable: true,
                dataZoom : {
                    show : true,
                    realtime : true,
                    start : 20,
                    end : 80
                },
                xAxis: [{
                    type: "category",
                    boundaryGap: !1,
                    data: [{% for visit in visit_list %}"{{visit.visitdate}}",{% endfor %}]
                }],
                yAxis: [{
                    type: "value"
                }],
                series: [{% for sledai in SLEDAIdata %}
                {
                    name: "{{sledai.name}}",
                    type: "line",
                    smooth: !0,
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                type: "default"
                            }
                        }
                    },
                    data: [{% for value in sledai.values %}{{value}},{% endfor %}]     
                },
                {% endfor %}
                ]
            })
        }
        if ($("#chart_Followup_med").length) {
            var b = echarts.init(document.getElementById("chart_Followup_med"), a);
            b.setOption({
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: [{% for med in MEDdata %}"{{med.name}}",{% endfor %}],
                    selected: {
                        'MTX' : false
                    },
                },
                toolbox: {
                    show: true,
                    feature : {
                        magicType : {show: true, type: ['line', 'bar']},
                        restore : {show: true},
                    }
                },
                calculable: true,
                dataZoom : {
                    show : true,
                    realtime : true,
                    start : 20,
                    end : 80
                },
                xAxis: [{
                    type: "category",
                    boundaryGap : true,
                    data : [{% for visit in visit_list %}"{{visit.visitdate}}",{% endfor %}]
                }],
                yAxis: [{
                    type: "value"
                }],
                series: [{% for med in MEDdata %}
                {
                    name: "{{med.name}}",
                    type: "bar",
                    smooth: !0,
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                type: "default"
                            }
                        }
                    },
                    data: [{% for value in med.values %}{{value}},{% endfor %}] 
                },
                {% endfor %}
                ]
            })
        }
        if ($("#chart_Followup_lab").length) {
            var b = echarts.init(document.getElementById("chart_Followup_lab"), a);
            b.setOption({
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: [{% for lab in LABdata %}"{{lab.name}}",{% endfor %}],
                    selected: {
                        {% for lab in LABdata %}
                        '{{lab.name}}' : false,
                        {% endfor %}
                        'Hb' : true
                    },
                },
                toolbox: {
                    show: true,
                    feature : {
                        magicType : {show: true, type: ['line', 'bar']},
                        restore : {show: true},
                    }
                },
                calculable: true,
                dataZoom : {
                    show : true,
                    realtime : true,
                    start : 20,
                    end : 80
                },
                xAxis: [{
                    type: "category",
                    boundaryGap : true,
                    data : [{% for visit in visit_list %}"{{visit.visitdate}}",{% endfor %}]
                }],
                yAxis: [{
                    type: "value"
                }],
                series: [{% for lab in LABdata %}
                {
                    name: "{{lab.name}}",
                    type: "line",
                    data: [{% for value in lab.values %}{{value}},{% endfor %}] 
                },
                {% endfor %}
                ]
            })
        }
    }
</script>
    <!-- /#wrapper -->
{% endblock %}