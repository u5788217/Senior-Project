{% extends "header.html" %}
{% block content %}  
    <script>
    function compare(a,b) {
        if (a.hn < b.hn)
            return -1;
        if (a.hn > b.hn)
            return 1;
        return 0;
    }
    
    $(document).ready(function(){
            $("#savehn").click(function(){
                var input_list = [];
               {% for hn in hns %}
                    tmpinput = $("#{{hn.studynumber}}")
                    input_list.push(tmpinput.val());
                {% endfor %}
                $("#hnck").prop('checked', false);
                message = "";
                for(var i = 0; i < input_list.length - 1; i++) {
                    message += input_list[i]+" ";
                }
                alert(message); 
            });
        });
        
    function testcheck(){
            
            {% for hn in hns %}
                tmpinput = $("#{{hn.studynumber}}").val()
                if(tmpinput !== null) input_list.push(tmpinput.value);
            {% endfor %}
            var sorted_arr = input_list.sort(compare);
            var results = [];
//            for (var i = 0; i < sorted_arr.length - 1; i++) {
//                results.push(sorted_arr[i]);
//                if(i>0){
//                    if (sorted_arr[i].hn == sorted_arr[i + 1].hn || sorted_arr[i].hn == sorted_arr[i - 1].hn) {}
//                    else {
//                        results.splice(i, 1); 
//                    }
//                }
//                else {
//                    if (sorted_arr[i].hn == sorted_arr[i + 1].hn) {}
//                    else {
//                        results.splice(i, 1); 
//                    }
//                }
//            }

            $("#hnck").prop('checked', false);
            message = "";
            for(var i = 0; i < input_list.length - 1; i++) {
                message += input_list[i]+" ";
            }
            alert(message); 
            
        }
        
        function CheckHN(input){
            var tmpinput = input.value;
            var tmp;
           {% for data in hn_list %}
               tmp = "{{data.hn}}";
               st = "{{data.st}}";
               if(tmpinput.localeCompare(tmp) == 0){
                   $("#hnck").prop('checked', false);
                   alert('(HN) '+tmpinput+ ' is already used for (StudyNumber) '+st+'.');
               }
//               else $("#hnck").prop('checked', true);
           {% endfor %}                    
        }
    </script>
       <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" href="{% url 'index' %}">SLE Flare-up Predictor</a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav ">
                <!--Normal-->
                <li>
                <a href="{% url 'index' %}"><i class="fa fa-home"></i> Home </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i> {{user}} <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        {% if user|lower == 'admin' %}
                        <li>
                            <a href="{% url 'hnDetail' %}"><i class="fa fa-fw fa-user"></i> HN detail</a>
                        </li>
                        {% endif %}
                        <li>
                            <a href="{% url 'logout' %}"><i class="fa fa-fw fa-power-off"></i> Log out</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <form method="post" action="{% url 'hnEditPost' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div id="page-wrapper" >
            <div class="container-fluid"> 
                <div class="row">
                    <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12 col-md-offset-2">
                        <div class="x_panel">
                            <div class="x_title"> 
                                {% load staticfiles %}
                                <h2>SLE Patients</h2>
								<ul class="nav navbar-right panel_toolbox">
                                    <li style="border-right: 2px solid #E6E6E6;"><button type="submit" style="color: #2F7C49; margin-right: 7px;" id="savehn">Save</button></li>
									<li><a href="" style="margin-left: 7px;" onclick="window.history.go(-1); return false;"> Cancel</a></li>
								</ul>
								<div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                        <table id="datatable" class="table table-bordered table-hover table-striped jambo_table bulk_action" >
                                        <thead>
                                            <tr>                                            
                                                <th class="col-md-3">Study Number</th>                                               
                                                <th class="col-md-3">HN</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                         {% for hn in hns %}
                                            <tr>
                                                <td>{{hn.studynumber}}</td>
                                                <td><input type="text" id="{{hn.studynumber}}" name="{{hn.studynumber}}" value="{{ hn.hn|default:"" }}" onchange="CheckHN(this);">
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                            <div style="display: none;" ><input type="checkbox" id="hnck" required></div>
                                    </table>
                                </div>    
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </form>
{% endblock %}